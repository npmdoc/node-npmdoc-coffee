<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/popomore/coffee">coffee (v3.3.0)</a>
</h1>
<h4>Test command line on nodejs</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.coffee">module coffee</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee">
            function <span class="apidocSignatureSpan">coffee.</span>Coffee
            <span class="apidocSignatureSpan">(opt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.fork">
            function <span class="apidocSignatureSpan">coffee.</span>fork
            <span class="apidocSignatureSpan">(modulePath, args, opt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.spawn">
            function <span class="apidocSignatureSpan">coffee.</span>spawn
            <span class="apidocSignatureSpan">(cmd, args, opt)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">coffee.</span>Coffee.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.coffee.Coffee">module coffee.Coffee</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.Coffee">
            function <span class="apidocSignatureSpan">coffee.</span>Coffee
            <span class="apidocSignatureSpan">(opt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.super_">
            function <span class="apidocSignatureSpan">coffee.Coffee.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.coffee.Coffee.prototype">module coffee.Coffee.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.prototype._run">
            function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>_run
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.prototype.coverage">
            function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>coverage
            <span class="apidocSignatureSpan">(isCoverage)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.prototype.debug">
            function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>debug
            <span class="apidocSignatureSpan">(level)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.prototype.end">
            function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>end
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.prototype.expect">
            function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>expect
            <span class="apidocSignatureSpan">(type, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.prototype.notExpect">
            function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>notExpect
            <span class="apidocSignatureSpan">(type, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.prototype.restore">
            function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>restore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.coffee.Coffee.prototype.write">
            function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>write
            <span class="apidocSignatureSpan">(value)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.coffee" id="apidoc.module.coffee">module coffee</a></h1>


    <h2>
        <a href="#apidoc.element.coffee.Coffee" id="apidoc.element.coffee.Coffee">
        function <span class="apidocSignatureSpan">coffee.</span>Coffee
        <span class="apidocSignatureSpan">(opt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Coffee(opt) {
  EventEmitter.call(this);
  opt || (opt = {});
  assert(opt.method &amp;&amp; opt.cmd, 'should specify method and cmd');
  this.method = opt.method;
  this.cmd = opt.cmd;
  this.args = opt.args;
  this.opt = opt.opt;
  this.restore();

  var self = this;
  this.on('stdout_data', function(buf) {
    debug('output stdout `%s`', show(buf));
    self._debug_stdout &amp;&amp; process.stdout.write(buf);
    self.stdout += buf;
  });
  this.on('stderr_data', function(buf) {
    debug('output stderr `%s`', show(buf));
    self._debug_stderr &amp;&amp; process.stderr.write(buf);
    self.stderr += buf;
  });
  this.on('error', function(err) {
    self.error = err;
  });
  this.once('close', function(code) {
    // restore coffee_inject_istanbul
    process.env.coffee_inject_istanbul = 'false';
    debug('output code `%s`', show(code));
    self.code = code;
    try {
      assertion(self.waitAssert.stdout, self.stdout, 'match stdout');
      assertion(self.waitAssert.stderr, self.stderr, 'match stderr');
      assertion(self.waitAssert.code, self.code, 'match code');
      self.error &amp;&amp; assertion(self.waitAssert.error, self.error.message, 'match error message');
    } catch (err) {
      return done(err);
    }
    done();
  });
  function done(err) {
    self.complete = true;
    if (self.cb) {
      self.cb.call(self, err, {
        stdout: self.stdout,
        stderr: self.stderr,
        code: self.code,
        error: self.error,
      });
    } else {
      if (err) {
        self.emit('complete_error', err);
      } else {
        self.emit('complete_success', {
          stdout: self.stdout,
          stderr: self.stderr,
        });
      }
    }
  }

  if (process.env.COFFEE_DEBUG) {
    this.debug(process.env.COFFEE_DEBUG);
  }

  process.nextTick(this._run.bind(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.fork" id="apidoc.element.coffee.fork">
        function <span class="apidocSignatureSpan">coffee.</span>fork
        <span class="apidocSignatureSpan">(modulePath, args, opt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">fork = function (modulePath, args, opt) {
  return new Coffee({
    method: 'fork',
    cmd: modulePath,
    args: args,
    opt: opt,
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  })
})
```

You can also use fork for spawning Node processes.

```js
coffee.<span class="apidocCodeKeywordSpan">fork</span>('/path/to/file.js', ['args '])
.expect('stdout', '12\n')
.expect('stderr', '34\n')
.expect('code', 0)
.end(done);
```

In file.js
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.spawn" id="apidoc.element.coffee.spawn">
        function <span class="apidocSignatureSpan">coffee.</span>spawn
        <span class="apidocSignatureSpan">(cmd, args, opt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">spawn = function (cmd, args, opt) {
  return new Coffee({
    method: 'spawn',
    cmd: cmd,
    args: args,
    opt: opt,
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Coffee is useful for test command line in test frammework (like Mocha).

```js
describe('cat', function() {
  it('should concat input', function(done) {
    var coffee = require('coffee');
    coffee.<span class="apidocCodeKeywordSpan">spawn</span>('cat')
    .write('1')
    .write('2')
    .expect('stdout', '12')
    .expect('code', 0)
    .end(done);
  })
})
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.coffee.Coffee" id="apidoc.module.coffee.Coffee">module coffee.Coffee</a></h1>


    <h2>
        <a href="#apidoc.element.coffee.Coffee.Coffee" id="apidoc.element.coffee.Coffee.Coffee">
        function <span class="apidocSignatureSpan">coffee.</span>Coffee
        <span class="apidocSignatureSpan">(opt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Coffee(opt) {
  EventEmitter.call(this);
  opt || (opt = {});
  assert(opt.method &amp;&amp; opt.cmd, 'should specify method and cmd');
  this.method = opt.method;
  this.cmd = opt.cmd;
  this.args = opt.args;
  this.opt = opt.opt;
  this.restore();

  var self = this;
  this.on('stdout_data', function(buf) {
    debug('output stdout `%s`', show(buf));
    self._debug_stdout &amp;&amp; process.stdout.write(buf);
    self.stdout += buf;
  });
  this.on('stderr_data', function(buf) {
    debug('output stderr `%s`', show(buf));
    self._debug_stderr &amp;&amp; process.stderr.write(buf);
    self.stderr += buf;
  });
  this.on('error', function(err) {
    self.error = err;
  });
  this.once('close', function(code) {
    // restore coffee_inject_istanbul
    process.env.coffee_inject_istanbul = 'false';
    debug('output code `%s`', show(code));
    self.code = code;
    try {
      assertion(self.waitAssert.stdout, self.stdout, 'match stdout');
      assertion(self.waitAssert.stderr, self.stderr, 'match stderr');
      assertion(self.waitAssert.code, self.code, 'match code');
      self.error &amp;&amp; assertion(self.waitAssert.error, self.error.message, 'match error message');
    } catch (err) {
      return done(err);
    }
    done();
  });
  function done(err) {
    self.complete = true;
    if (self.cb) {
      self.cb.call(self, err, {
        stdout: self.stdout,
        stderr: self.stderr,
        code: self.code,
        error: self.error,
      });
    } else {
      if (err) {
        self.emit('complete_error', err);
      } else {
        self.emit('complete_success', {
          stdout: self.stdout,
          stderr: self.stderr,
        });
      }
    }
  }

  if (process.env.COFFEE_DEBUG) {
    this.debug(process.env.COFFEE_DEBUG);
  }

  process.nextTick(this._run.bind(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.Coffee.super_" id="apidoc.element.coffee.Coffee.super_">
        function <span class="apidocSignatureSpan">coffee.Coffee.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.coffee.Coffee.prototype" id="apidoc.module.coffee.Coffee.prototype">module coffee.Coffee.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.coffee.Coffee.prototype._run" id="apidoc.element.coffee.Coffee.prototype._run">
        function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>_run
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_run = function () {
  this._isEndCalled = true;
  // inject istanbul when start with istanbul and set coverage true
  // https://github.com/gotwarlost/istanbul#multiple-process-usage
  process.env.coffee_inject_istanbul = process.env.running_under_istanbul ? this._isCoverage : false;
  debug('coverage enable: %s', process.env.coffee_inject_istanbul);
  var cmd = this.proc = run(this.method, this.cmd, this.args, this.opt);

  cmd.stdout &amp;&amp; cmd.stdout.on('data', this.emit.bind(this, 'stdout_data'));
  cmd.stderr &amp;&amp; cmd.stderr.on('data', this.emit.bind(this, 'stderr_data'));
  cmd.once('error', this.emit.bind(this, 'error'));
  cmd.once('close', this.emit.bind(this, 'close'));

  if (this.stdin.length) {
    this.stdin.forEach(function(buf) {
      debug('input stdin `%s`', show(buf));
      cmd.stdin.write(buf);
    });
    cmd.stdin.end();
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.Coffee.prototype.coverage" id="apidoc.element.coffee.Coffee.prototype.coverage">
        function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>coverage
        <span class="apidocSignatureSpan">(isCoverage)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">coverage = function (isCoverage) {
  if (isCoverage === false) {
    this._isCoverage = false;
  }
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
==================

* fix: should inject coverage when start with istanbul

3.0.0 / 2016-01-05
==================

* feat: ignore coverage or not by .<span class="apidocCodeKeywordSpan">coverage</span>()
* feat: spawn without .end, use nextTick (break change)
* feat: pass a number to .debug

2.1.0 / 2015-11-17
==================

* feat: export this.proc
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.Coffee.prototype.debug" id="apidoc.element.coffee.Coffee.prototype.debug">
        function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>debug
        <span class="apidocSignatureSpan">(level)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">debug = function (level) {
  this._debug_stdout = false;
  this._debug_stderr = false;

  // 0 (default) -&gt; stdout + stderr
  // 1 -&gt; stdout
  // 2 -&gt; stderr
  switch (String(level)) {
    case '1':
      this._debug_stdout = true;
      break;
    case '2':
      this._debug_stderr = true;
      break;
    case 'false':
      this._debug_stdout = false;
      this._debug_stderr = false;
      break;
    default:
      this._debug_stdout = true;
      this._debug_stderr = true;
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Write data to stdin, see example above.

#### coffee.end(callback)

Callback will be called after completing the assertion, the first argument is Error if throw exception.

#### coffee.<span class="apidocCodeKeywordSpan">debug</span>(level)

Write data to process.stdout and process.stderr for debug

`level` can be

- 0 (default): pipe stdout + stderr
- 1: pipe stdout
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.Coffee.prototype.end" id="apidoc.element.coffee.Coffee.prototype.end">
        function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>end
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">end = function (cb) {
  this.cb = cb;
  if (!cb) {
    return new Promise((resolve, reject) =&gt; {
      this.on('complete_success', resolve);
      this.on('complete_error', reject);
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  it('should concat input', function(done) {
    var coffee = require('coffee');
    coffee.spawn('cat')
    .write('1')
    .write('2')
    .expect('stdout', '12')
    .expect('code', 0)
    .<span class="apidocCodeKeywordSpan">end</span>(done);
  })
})
```

You can also use fork for spawning Node processes.

```js
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.Coffee.prototype.expect" id="apidoc.element.coffee.Coffee.prototype.expect">
        function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>expect
        <span class="apidocSignatureSpan">(type, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">expect = function (type, value) {
  if (acceptType.indexOf(type) &gt; -1) {
    var rule = new Rule(value);
    if (this.complete) {
      assertion([ rule ], this[type], 'match ' + type);
    } else {
      this.waitAssert[type].push(rule);
    }
  }
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```js
describe('cat', function() {
  it('should concat input', function(done) {
    var coffee = require('coffee');
    coffee.spawn('cat')
    .write('1')
    .write('2')
    .<span class="apidocCodeKeywordSpan">expect</span>('stdout', '12')
    .expect('code', 0)
    .end(done);
  })
})
```

You can also use fork for spawning Node processes.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.Coffee.prototype.notExpect" id="apidoc.element.coffee.Coffee.prototype.notExpect">
        function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>notExpect
        <span class="apidocSignatureSpan">(type, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">notExpect = function (type, value) {
  if (acceptType.indexOf(type) &gt; -1) {
    var rule = new Rule(value, true);
    if (this.complete) {
      assertion([ rule ], this[type], 'match ' + type);
    } else {
      this.waitAssert[type].push(rule);
    }
  }
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
.expect('stdout', /^abc/)
.expect('stdout', ['abcdefg', /abc/])
.end(done);
```

Accept type: `stdout`, `stderr`, `code`, `error`

#### coffee.<span class="apidocCodeKeywordSpan">notExpect</span>(type, expected)

The opposite assertion of `expect`.

#### coffee.write(data)

Write data to stdin, see example above.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.Coffee.prototype.restore" id="apidoc.element.coffee.Coffee.prototype.restore">
        function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>restore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">restore = function () {
  // cache input for command
  this.stdin = [];

  // cache output for command
  this.stdout = '';
  this.stderr = '';
  this.code = null;
  this.error = null;

  // cache expected output
  this.waitAssert = {
    stderr: [],
    stdout: [],
    code: [],
    error: [],
  };
  this.complete = false;
  this._isEndCalled = false;
  this._debug_stdout = false;
  this._debug_stderr = false;
  this._isCoverage = true;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
EventEmitter.call(this);
opt || (opt = {});
assert(opt.method &amp;&amp; opt.cmd, 'should specify method and cmd');
this.method = opt.method;
this.cmd = opt.cmd;
this.args = opt.args;
this.opt = opt.opt;
this.<span class="apidocCodeKeywordSpan">restore</span>();

var self = this;
this.on('stdout_data', function(buf) {
  debug('output stdout `%s`', show(buf));
  self._debug_stdout &amp;&amp; process.stdout.write(buf);
  self.stdout += buf;
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.coffee.Coffee.prototype.write" id="apidoc.element.coffee.Coffee.prototype.write">
        function <span class="apidocSignatureSpan">coffee.Coffee.prototype.</span>write
        <span class="apidocSignatureSpan">(value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">write = function (value) {
  assert(!this._isEndCalled, 'can\'t call write after end');
  this.stdin.push(value);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Coffee is useful for test command line in test frammework (like Mocha).

```js
describe('cat', function() {
  it('should concat input', function(done) {
    var coffee = require('coffee');
    coffee.spawn('cat')
    .<span class="apidocCodeKeywordSpan">write</span>('1')
    .write('2')
    .expect('stdout', '12')
    .expect('code', 0)
    .end(done);
  })
})
```
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>